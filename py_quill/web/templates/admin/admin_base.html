{% extends "root.html" %}
{% from "partials/site_header.html" import site_header %}

{% block title %}{% block admin_title %}Admin Â· {{ site_name }}{% endblock %}{% endblock %}

{% block body %}
{% set current_path = request.path %}
{% set dashboard_url = url_for('web.admin_dashboard') %}
{% set joke_categories_url = url_for('web.admin_joke_categories') %}
{% set joke_books_url = url_for('web.admin_joke_books') %}
{% set joke_books_prefix = joke_books_url.rstrip('/') %}
{% set printable_notes_categories_url = url_for('web.admin_printable_notes_categories') %}
{% set printable_notes_manual_url = url_for('web.admin_printable_notes_manual') %}
{% set jokes_url = url_for('web.admin_jokes') %}
{% set social_url = url_for('web.admin_social') %}
<div class="site-shell admin-site-shell">
  {% call site_header(dashboard_url, site_name + " Admin", site_name, True) %}
        <a class="nav-link text-button{% if current_path == dashboard_url %} nav-link--active{% endif %}"
          href="{{ dashboard_url }}">
          Dashboard
        </a>
        <a class="nav-link text-button{% if current_path == jokes_url %} nav-link--active{% endif %}"
          href="{{ jokes_url }}">
          Jokes
        </a>
        <a class="nav-link text-button{% if current_path == social_url %} nav-link--active{% endif %}"
          href="{{ social_url }}">
          Social
        </a>
        <a class="nav-link text-button{% if current_path == joke_categories_url %} nav-link--active{% endif %}"
          href="{{ joke_categories_url }}">
          Categories
        </a>
        <div class="user-menu user-menu--visible" data-notes-menu>
          <button class="user-menu__trigger text-button"
            type="button"
            aria-haspopup="menu"
            aria-expanded="false"
            data-notes-menu-trigger>
            <span>Printable Notes</span>
            <span class="user-menu__chevron" aria-hidden="true">v</span>
          </button>
          <div class="user-menu__panel" role="menu" data-notes-menu-panel>
            <a class="user-menu__item text-button"
              role="menuitem"
              href="{{ printable_notes_categories_url }}">
              Category Notes
            </a>
            <a class="user-menu__item text-button"
              role="menuitem"
              href="{{ printable_notes_manual_url }}">
              Manual Notes
            </a>
          </div>
        </div>
        <a class="nav-link text-button{% if current_path.startswith(joke_books_prefix) %} nav-link--active{% endif %}"
          href="{{ joke_books_url }}">
          Joke Books
        </a>
        {% include "partials/user_nav_menu.html" %}
  {% endcall %}
  <main class="site-main">
    <div class="main-container">
      {% block content %}{% endblock %}
    </div>
  </main>
  <footer class="site-footer">
    <div class="site-footer__inner text-footer">
      <small>&copy; {{ site_name }} {{ now_year|default(2025) }}</small>
      <a class="site-footer__link"
        href="/privacy.html"
        target="_blank"
        rel="noopener noreferrer"
        data-analytics-event="web_footer_privacy_click"
        data-analytics-label="privacy_policy">
        Privacy Policy
      </a>
    </div>
  </footer>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
  (function () {
    if (typeof document === 'undefined' || !document.querySelectorAll) {
      return;
    }
    var menus = Array.prototype.slice.call(
      document.querySelectorAll('[data-notes-menu]')
    );
    if (!menus.length) {
      return;
    }

    function closeMenu(menu) {
      if (!menu.classList.contains('user-menu--open')) {
        return;
      }
      menu.classList.remove('user-menu--open');
      var trigger = menu.querySelector('[data-notes-menu-trigger]');
      if (trigger) {
        trigger.setAttribute('aria-expanded', 'false');
      }
    }

    function openMenu(menu) {
      menu.classList.add('user-menu--open');
      var trigger = menu.querySelector('[data-notes-menu-trigger]');
      if (trigger) {
        trigger.setAttribute('aria-expanded', 'true');
      }
    }

    menus.forEach(function (menu) {
      var trigger = menu.querySelector('[data-notes-menu-trigger]');
      if (!trigger) {
        return;
      }

      trigger.addEventListener('click', function (event) {
        event.stopPropagation();
        if (menu.classList.contains('user-menu--open')) {
          closeMenu(menu);
        } else {
          openMenu(menu);
        }
      });

      document.addEventListener('click', function (event) {
        if (!menu.contains(event.target)) {
          closeMenu(menu);
        }
      });

      document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape') {
          closeMenu(menu);
        }
      });
    });
  })();
</script>
{% endblock %}
