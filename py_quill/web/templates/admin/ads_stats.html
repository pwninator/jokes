{% extends "admin/admin_base.html" %}

{% block title %}Ads Stats Â· {{ site_name }} Admin{% endblock %}

{% block content %}
<div class="dashboard-header">
  <h2>Ads Stats</h2>
  <a href="{{ url_for('web.admin_dashboard') }}">Back to Dashboard</a>
</div>

<style>
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
  }
  .stat-card {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 12px;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    box-shadow: 0 4px 12px var(--color-shadow);
  }
  .stat-card__label {
    font-size: 0.8rem;
    color: var(--color-text-muted);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  .stat-card__value {
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--color-text);
  }
</style>

<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-card__label">Impressions</div>
    <div class="stat-card__value">{{ "{:,.0f}".format(chart_data.total_impressions) }}</div>
  </div>
  <div class="stat-card">
    <div class="stat-card__label">Clicks</div>
    <div class="stat-card__value">{{ "{:,.0f}".format(chart_data.total_clicks) }}</div>
  </div>
  <div class="stat-card">
    <div class="stat-card__label">Cost</div>
    <div class="stat-card__value">{{ "${:,.2f}".format(chart_data.total_cost) }}</div>
  </div>
  <div class="stat-card">
    <div class="stat-card__label">Sales</div>
    <div class="stat-card__value">{{ "${:,.2f}".format(chart_data.total_sales) }}</div>
  </div>
  <div class="stat-card">
    <div class="stat-card__label">Gross Profit (Pre-Ad)</div>
    <div class="stat-card__value">{{ "${:,.2f}".format(chart_data.total_gross_profit_before_ads) }}</div>
  </div>
  <div class="stat-card">
    <div class="stat-card__label">Gross Profit</div>
    <div class="stat-card__value">{{ "${:,.2f}".format(chart_data.total_gross_profit) }}</div>
  </div>
</div>

<p class="muted" style="margin: 0 0 16px;">
  Aggregated daily Amazon Ads performance for {{ start_date }} to {{ end_date }}.
</p>

<section class="stats-charts">
  <div class="chart-container" style="position: relative; height:320px; width:100%; margin-bottom: 28px;">
    <h3>Impressions</h3>
    <canvas id="impressionsChart"></canvas>
  </div>
  <div class="chart-container" style="position: relative; height:320px; width:100%; margin-bottom: 28px;">
    <h3>Clicks</h3>
    <canvas id="clicksChart"></canvas>
  </div>
  <div class="chart-container" style="position: relative; height:320px; width:100%; margin-bottom: 28px;">
    <h3>Cost</h3>
    <canvas id="costChart"></canvas>
  </div>
  <div class="chart-container" style="position: relative; height:320px; width:100%;">
    <h3>Sales</h3>
    <canvas id="salesChart"></canvas>
  </div>
  <div class="chart-container" style="position: relative; height:320px; width:100%; margin-top: 28px; margin-bottom: 28px;">
    <h3>Gross Profit Before Ads</h3>
    <canvas id="grossProfitBeforeAdsChart"></canvas>
  </div>
  <div class="chart-container" style="position: relative; height:320px; width:100%;">
    <h3>Gross Profit</h3>
    <canvas id="grossProfitChart"></canvas>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const adsStatsData = {{ chart_data | tojson }};

  function createLineChart(canvasId, label, values, color, isCurrency) {
    const ctx = document.getElementById(canvasId).getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: adsStatsData.labels,
        datasets: [{
          label: label,
          data: values,
          borderColor: color,
          backgroundColor: color + '22',
          fill: true,
          tension: 0.2,
          pointRadius: 3
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              callback: function(value) {
                if (!isCurrency) {
                  return value;
                }
                return '$' + Number(value).toFixed(2);
              }
            }
          }
        }
      }
    });
  }

  createLineChart('impressionsChart', 'Impressions', adsStatsData.impressions, '#2e7d32', false);
  createLineChart('clicksChart', 'Clicks', adsStatsData.clicks, '#1565c0', false);
  createLineChart('costChart', 'Cost', adsStatsData.cost, '#6a1b9a', true);
  createLineChart('salesChart', 'Sales', adsStatsData.sales, '#ef6c00', true);
  createLineChart('grossProfitBeforeAdsChart', 'Gross Profit Before Ads', adsStatsData.gross_profit_before_ads, '#00695c', true);
  createLineChart('grossProfitChart', 'Gross Profit', adsStatsData.gross_profit, '#ad1457', true);
</script>
{% endblock %}
