{% extends "root.html" %}
{% from "partials/site_header.html" import site_header %}

{# NOTE: Keep this outside of `head_meta` so nested blocks can see it. #}
{% set default_meta_description = "Don't just read jokes, see them! Snickerdoodle Jokes pairs hilarious puns with adorable art. Grab the illustrated Book or download the App today." %}

{% block title %}{{ site_name }} jokes{% endblock %}

{% block head_meta %}
{% set meta_title = self.title() | striptags | trim %}
{% set meta_description %}{% block meta_description %}{{ default_meta_description }}{% endblock %}{% endset %}
{% set meta_description = meta_description | striptags | trim %}
<meta name="description"
  content="{{ meta_description }}">
<link rel="canonical" href="{{ canonical_url }}">
{% if prev_url %}
<link rel="prev" href="{{ prev_url }}">{% endif %}
{% if next_url %}
<link rel="next" href="{{ next_url }}">{% endif %}

<!-- Open Graph -->
<meta property="og:title" content="{{ meta_title }}">
<meta property="og:description"
  content="{{ meta_description }}">
<meta property="og:type" content="website">
<meta property="og:url" content="{{ canonical_url }}">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ meta_title }}">
<meta name="twitter:description"
  content="{{ meta_description }}">
{% endblock %}

{% block body %}
{% set current_path = request.path %}
{% set brand_is_clickable = brand_is_clickable|default(true) %}
<div class="site-shell">
  {% call site_header('/', site_name, site_name, brand_is_clickable) %}
        <ul class="nav-list">
          <li>
            <a class="nav-link text-button{% if current_path == '/' %} nav-link--active{% endif %}"
              href="/"
              data-analytics-event="web_nav_jokes_click"
              data-analytics-label="jokes">
              Jokes
            </a>
          </li>
          <li>
            <a class="nav-link text-button{% if current_path == '/printables/notes' or current_path == '/printables/notes/all' %} nav-link--active{% endif %}"
              href="{{ url_for('web.notes') }}"
              aria-label="Printable Joke Notes"
              data-analytics-event="web_nav_notes_click"
              data-analytics-label="printable_joke_notes">
              Printables
            </a>
          </li>
          <li>
            <a class="nav-link text-button"
              href="{{ nav_amazon_book_url }}"
              target="_blank"
              rel="noopener noreferrer"
              data-analytics-event="web_nav_book_click"
              data-analytics-label="book">
              Book
            </a>
          </li>
          <li>
            <a class="nav-link text-button"
              href="https://play.google.com/store/apps/details?id=com.builtwithporpoise.jokes"
              target="_blank"
              rel="noopener noreferrer"
              data-analytics-event="web_nav_app_click"
              data-analytics-label="mobile_app">
              App
            </a>
          </li>
          <li>
            <a class="nav-link text-button{% if current_path == '/about' %} nav-link--active{% endif %}"
              href="{{ url_for('web.about') }}"
              data-analytics-event="web_nav_about_click"
              data-analytics-label="about">
              About
            </a>
          </li>
        </ul>
  {% endcall %}
  <main class="site-main">
    <div class="main-container">
      {% block content %}{% endblock %}
    </div>
  </main>
  <footer class="site-footer">
    <div class="site-footer__inner text-footer">
      <small>&copy; {{ site_name }} {{ now_year|default(2025) }}</small>
      <a class="site-footer__link"
        href="/privacy.html"
        target="_blank"
        rel="noopener noreferrer"
        data-analytics-event="web_footer_privacy_click"
        data-analytics-label="privacy_policy">
        Privacy Policy
      </a>
    </div>
  </footer>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
(function () {
  function initViewer(root) {
    // Skip if already initialized
    if (root.dataset.jokeViewerInitialized) {
      return;
    }

    const track = root.querySelector('.joke-carousel-track');
    const slides = root.querySelectorAll('.joke-slide');
    const toggle = root.querySelector('[data-role="reveal"]');
    if (!track || slides.length < 2 || !toggle) {
      return;
    }

    const showLabel = toggle.getAttribute('data-label-show') || toggle.textContent || 'Reveal';
    const hideLabel = toggle.getAttribute('data-label-hide') || showLabel;
    const setupSlide = slides[0];
    const punchlineSlide = slides[1];

    function setState(isRevealed) {
      root.classList.toggle('is-revealed', isRevealed);
      toggle.textContent = isRevealed ? hideLabel : showLabel;
      toggle.setAttribute('aria-expanded', String(isRevealed));
      setupSlide.setAttribute('aria-hidden', String(isRevealed));
      punchlineSlide.setAttribute('aria-hidden', String(!isRevealed));
    }

    setState(false);
    toggle.addEventListener('click', function () {
      setState(!root.classList.contains('is-revealed'));
    });

    // Mark as initialized to prevent duplicate initialization
    root.dataset.jokeViewerInitialized = 'true';
  }

  // Make initViewer globally accessible for dynamically loaded content
  window.initJokeViewer = initViewer;

  // Initialize all existing viewers on page load
  document.querySelectorAll('[data-joke-viewer]').forEach(initViewer);
})();
</script>
{% block extra_scripts %}{% endblock %}
{% endblock %}
 
