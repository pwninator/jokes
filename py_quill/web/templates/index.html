{% extends "base.html" %}
{% block title %}Snickerdoodle Jokes | Daily Fun for Everyone{% endblock %}

{% block head_extra %}
<meta name="description"
  content="Fresh from the oven: a daily illustrated joke waiting to brighten your morning.">
<meta property="og:title" content="Snickerdoodle Jokes | Daily Fun for Everyone">
<meta property="og:description"
  content="Today's joke: {% if daily_joke %}{{ daily_joke.setup_text }}{% else %}A delightful laugh awaits{% endif %}">
<meta property="og:image"
  content="https://images.quillsstorybook.com/cdn-cgi/image/width=1024,format=auto,quality=75/banner001.png">
<meta property="og:url" content="{{ canonical_url }}">
<meta name="twitter:card" content="summary_large_image">
{% endblock %}

{% block content %}
<section class="hero" aria-labelledby="hero-title">
  <div>
    <span class="hero-pill text-button">{{ hero_date_label }}</span>
    <h1 class="hero-title text-display" id="hero-title">Fresh from the oven</h1>
    <p class="hero-subtitle text-body">Start your day with a sprinkle of sweetness. We bake a brand-new, wholesome joke every single morning to make you smile.</p>
  </div>
  <article class="hero-card" id="daily-joke-card" aria-labelledby="hero-card-title">
    {% if daily_joke %}
    <div class="joke-viewer" data-joke-viewer>
      <div class="joke-carousel">
        <div class="joke-carousel-viewport">
          <div class="joke-carousel-track">
            <div class="joke-slide" aria-hidden="false">
              <div class="joke-slide-media">
                {% if daily_joke.setup_image_url %}
                <img src="{{ daily_joke.setup_image_url | replace('width=1024', 'width=' ~ 800) }}" alt="{{ daily_joke.setup_text }}" width="800" height="800" loading="lazy">
                {% else %}
                <div class="joke-slide-placeholder text-button">Illustration baking…</div>
                {% endif %}
              </div>
            </div>
            <div class="joke-slide" id="daily-joke-punchline" aria-hidden="true">
              <div class="joke-slide-media">
                {% if daily_joke.punchline_image_url %}
                <img src="{{ daily_joke.punchline_image_url | replace('width=1024', 'width=' ~ 800) }}" alt="{{ daily_joke.punchline_text }}" width="800" height="800" loading="lazy">
                {% else %}
                <div class="joke-slide-placeholder text-button">Punchline ready to read!</div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
      <button class="joke-reveal text-button"
        type="button"
        data-role="reveal"
        data-label-show="Reveal Punchline"
        data-label-hide="Back to Setup"
        aria-controls="daily-joke-punchline"
        aria-expanded="false"
        data-analytics-event="web_index_joke_scroll_click"
        data-analytics-label="{{ daily_joke.key or 'daily_joke' }}">
        Reveal Punchline
      </button>
    </div>
    {% else %}
    <div class="hero-card__image">
      <div class="app-highlight__placeholder text-button">Illustration baking…</div>
    </div>
    <p class="joke-punchline text-button">Check back soon for a fresh punchline!</p>
    {% endif %}
  </article>
</section>

<section class="favorites-section" aria-labelledby="favorites-title">
  <header>
    <span class="visually-hidden">Fan-Favorite Jokes</span>
    <h2 class="favorites-title text-section-heading" id="favorites-title">Fan Favorites from the Cookie Jar</h2>
    <p class="favorites-subtitle text-body">A handful of the most-loved jokes, straight from the Snickerdoodle community.</p>
  </header>
  {% if favorites %}
  <div class="favorites-grid">
    {% for joke in favorites %}
    <article class="joke-card" aria-label="Fan favorite joke {{ loop.index }}">
      <div class="joke-viewer" data-joke-viewer>
        <div class="joke-carousel">
          <div class="joke-carousel-viewport">
            <div class="joke-carousel-track">
              <div class="joke-slide" aria-hidden="false">
                <div class="joke-slide-media">
                  {% if joke.setup_image_url %}
                  <img src="{{ joke.setup_image_url | replace('width=1024', 'width=' ~ 600) }}" alt="{{ joke.setup_text }}" width="600" height="600" loading="lazy">
                  {% else %}
                  <div class="joke-slide-placeholder text-button">Illustration baking…</div>
                  {% endif %}
                </div>
              </div>
              <div class="joke-slide" id="favorite-{{ loop.index }}-punchline" aria-hidden="true">
                <div class="joke-slide-media">
                  {% if joke.punchline_image_url %}
                  <img src="{{ joke.punchline_image_url | replace('width=1024', 'width=' ~ 600) }}" alt="{{ joke.punchline_text }}" width="600" height="600" loading="lazy">
                  {% else %}
                  <div class="joke-slide-placeholder text-button">Punchline ready to read!</div>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
        <button class="joke-reveal text-button"
          type="button"
          data-role="reveal"
          data-label-show="Reveal Punchline"
          data-label-hide="Back to Setup"
          aria-controls="favorite-{{ loop.index }}-punchline"
          aria-expanded="false"
          data-analytics-event="web_index_joke_scroll_click"
          data-analytics-label="{{ joke.key or 'favorite_joke' }}">
          Reveal Punchline
        </button>
      </div>
    </article>
    {% endfor %}
  </div>
  {% else %}
  <p class="favorites-subtitle text-body">Our cookie jar is cooling—check back soon for more fan-favorite jokes.</p>
  {% endif %}
</section>

<section class="app-highlight" id="app-highlight" aria-labelledby="app-highlight-title">
  <div class="app-highlight__copy">
    <h2 id="app-highlight-title" class="text-section-heading">Get your daily giggle delivered.</h2>
    <p class="text-body">Snickerdoodle serves a delightful illustrated joke every morning. Save your favorites, share them with friends, and explore themed collections in the app.</p>
    <div class="rating-chip text-button">★ 4.7 Stars · US Play Store</div>
    <a href="https://play.google.com/store/apps/details?id=com.builtwithporpoise.jokes"
      class="play-badge-link" target="_blank" rel="noopener noreferrer" aria-label="Get it on Google Play"
      data-analytics-event="web_index_play_store_click" data-analytics-label="joke_end_card">
      <img class="play-badge" alt="Get it on Google Play"
        src="https://play.google.com/intl/en_us/badges/static/images/badges/en_badge_web_generic.png" loading="lazy">
    </a>
  </div>
  <div class="app-highlight__media" aria-hidden="true">
    <div class="app-highlight__placeholder text-button">App preview baking…</div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
(function () {
  function initViewer(root) {
    const track = root.querySelector('.joke-carousel-track');
    const slides = root.querySelectorAll('.joke-slide');
    const toggle = root.querySelector('[data-role="reveal"]');
    if (!track || slides.length < 2 || !toggle) {
      return;
    }

    const showLabel = toggle.getAttribute('data-label-show') || toggle.textContent || 'Reveal';
    const hideLabel = toggle.getAttribute('data-label-hide') || showLabel;
    const setupSlide = slides[0];
    const punchlineSlide = slides[1];

    function setState(isRevealed) {
      root.classList.toggle('is-revealed', isRevealed);
      toggle.textContent = isRevealed ? hideLabel : showLabel;
      toggle.setAttribute('aria-expanded', String(isRevealed));
      setupSlide.setAttribute('aria-hidden', String(isRevealed));
      punchlineSlide.setAttribute('aria-hidden', String(!isRevealed));
    }

    setState(false);
    toggle.addEventListener('click', function () {
      setState(!root.classList.contains('is-revealed'));
    });
  }

  document.querySelectorAll('[data-joke-viewer]').forEach(initViewer);
})();
</script>
{% endblock %}
