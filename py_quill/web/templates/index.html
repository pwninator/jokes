{% extends "base.html" %}
{% from "components/joke_card.html" import joke_card %}
{% block title %}Snickerdoodle Jokes | Daily Fun for Everyone{% endblock %}

{% block meta_description %}Don't just read jokes, see them! Snickerdoodle Jokes pairs hilarious puns with adorable art. Grab the illustrated Book or download the App today.{% endblock %}

{% block head_extra %}
<meta property="og:image"
  content="https://images.quillsstorybook.com/cdn-cgi/image/width=1024,format=auto,quality=75/banner001.png">
<meta name="twitter:image"
  content="https://images.quillsstorybook.com/cdn-cgi/image/width=1024,format=auto,quality=75/banner001.png">
{% endblock %}

{% block content %}
<section class="hero" aria-labelledby="hero-title">
  <div>
    <span class="hero-pill text-button">{{ hero_date_label }}</span>
    <h1 class="hero-title text-display" id="hero-title">Fresh from the oven</h1>
    <p class="hero-subtitle text-body">Start your day with a sprinkle of sweetness. We bake a brand-new, wholesome joke every single morning to make you smile.</p>
  </div>
  <article class="hero-card" id="daily-joke-card" aria-labelledby="hero-card-title">
    {% if daily_joke %}
    {{ joke_card(daily_joke, reveal_label='Reveal Punchline', image_size=800, joke_id='daily-joke') }}
    {% else %}
    <div class="hero-card__image">
      <div class="app-highlight__placeholder text-button">Illustration baking…</div>
    </div>
    <p class="joke-punchline text-button">Check back soon for a fresh punchline!</p>
    {% endif %}
  </article>
</section>

<section class="favorites-section" aria-labelledby="favorites-title">
  <header class="section-header">
    <h2 class="favorites-title text-section-heading" id="favorites-title">Fan Favorites from the Cookie Jar</h2>
    <p class="favorites-subtitle text-body">A handful of the most-loved jokes, straight from the Snickerdoodle community.</p>
  </header>
  {% if favorites %}
  <div class="favorites-grid">
    {% for joke in favorites %}
    {{ joke_card(joke, reveal_label='Reveal Punchline', image_size=600, joke_id='favorite-' ~ loop.index) }}
    {% endfor %}
  </div>
  {% else %}
  <p class="favorites-subtitle text-body">Our cookie jar is cooling—check back soon for more fan-favorite jokes.</p>
  {% endif %}
</section>

<section class="app-highlight" id="app-highlight" aria-labelledby="app-highlight-title">
  <div class="app-highlight__media" aria-hidden="true">
    <img src="https://images.quillsstorybook.com/cdn-cgi/image/width=600,format=auto,quality=70/_joke_assets/phone_discover.png"
      alt="App preview" class="app-highlight__device-image" loading="lazy">
  </div>
  <div class="app-highlight__copy">
    <h2 id="app-highlight-title" class="text-section-heading inverse">Get your daily giggle delivered.</h2>
    <p class="text-body text-body inverse">Start your morning with our fresh-baked joke of the day. Still hungry for more? Dive into a personalized feed of funny illustrations tailored specifically to your taste.</p>
    <div class="app-highlight__stats">
      <div class="app-highlight__stat-card">
        <img src="https://images.quillsstorybook.com/cdn-cgi/image/height=64,format=auto,quality=70/_joke_assets/icon_stars.png"
             class="app-highlight__stat-icon" alt="Stars" loading="lazy">
        <div class="app-highlight__stat-copy">
          <span class="app-highlight__stat-label text-button">4.7 Stars</span>
          <span class="app-highlight__stat-caption">US Play Store</span>
        </div>
      </div>
      <div class="app-highlight__stat-card">
        <img src="https://images.quillsstorybook.com/cdn-cgi/image/height=64,format=auto,quality=70/_joke_assets/icon_downloads.png"
             class="app-highlight__stat-icon" alt="Downloads" loading="lazy">
        <div class="app-highlight__stat-copy">
          <span class="app-highlight__stat-label text-button">10k+</span>
          <span class="app-highlight__stat-caption">Downloads</span>
        </div>
      </div>
      <div class="app-highlight__stat-card">
        <img src="https://images.quillsstorybook.com/cdn-cgi/image/height=64,format=auto,quality=70/_joke_assets/icon_laughs.png"
             class="app-highlight__stat-icon" alt="Laughs" loading="lazy">
        <div class="app-highlight__stat-copy">
          <span class="app-highlight__stat-label text-button">300k+</span>
          <span class="app-highlight__stat-caption">Laughs Delivered</span>
        </div>
      </div>
    </div>
    <div class="app-highlight__store-badges">
      <a href="https://play.google.com/store/apps/details?id=com.builtwithporpoise.jokes"
        class="store-badge-link" target="_blank" rel="noopener noreferrer" aria-label="Get it on Google Play"
        data-analytics-event="web_index_play_store_click" data-analytics-label="joke_end_card">
        <img class="store-badge" alt="Get it on Google Play"
          src="https://images.quillsstorybook.com/cdn-cgi/image/height=60,format=auto,quality=80/_joke_assets/cta_play_store.png" loading="lazy">
      </a>
      <div class="store-badge-wrapper">
        <button type="button" class="store-badge-btn" aria-label="Download on the App Store"
          data-analytics-event="web_index_app_store_click" data-analytics-label="joke_end_card_coming_soon">
          <img class="store-badge" alt="Download on the App Store"
            src="https://images.quillsstorybook.com/cdn-cgi/image/height=60,format=auto,quality=80/_joke_assets/cta_app_store.png"
            loading="lazy">
        </button>
        <div class="store-tooltip" role="tooltip" aria-hidden="true">iPhone app coming soon!</div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
// Tooltip logic for App Store button
document.querySelectorAll('.store-badge-wrapper').forEach(function (wrapper) {
  const btn = wrapper.querySelector('.store-badge-btn');
  const tooltip = wrapper.querySelector('.store-tooltip');

  if (!btn || !tooltip) return;

  function show() {
    tooltip.classList.add('tooltip--visible');
    tooltip.setAttribute('aria-hidden', 'false');
    // Analytics are handled by global handler on the button
  }

  function hide() {
    tooltip.classList.remove('tooltip--visible');
    tooltip.setAttribute('aria-hidden', 'true');
  }

  function toggle(e) {
    e.preventDefault();
    e.stopPropagation();
    if (tooltip.classList.contains('tooltip--visible')) {
      hide();
    } else {
      show();
    }
  }

  btn.addEventListener('click', toggle);

  // Close on click outside
  document.addEventListener('click', function (e) {
    if (!wrapper.contains(e.target)) {
      hide();
    }
  });

  // Close on Escape
  document.addEventListener('keydown', function (e) {
    if (e.key === 'Escape') {
      hide();
    }
  });
});
</script>
{% endblock %}
