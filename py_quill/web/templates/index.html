{% extends "base.html" %}
{% block title %}Snickerdoodle Jokes | Daily Fun for Everyone{% endblock %}

{% block meta_description %}Don't just read jokes, see them! Snickerdoodle Jokes pairs hilarious puns with adorable art. Grab the illustrated Book or download the App today.{% endblock %}

{% block head_extra %}
<meta property="og:image"
  content="https://images.quillsstorybook.com/cdn-cgi/image/width=1024,format=auto,quality=75/banner001.png">
<meta name="twitter:image"
  content="https://images.quillsstorybook.com/cdn-cgi/image/width=1024,format=auto,quality=75/banner001.png">
{% endblock %}

{% block content %}
<section class="hero" aria-labelledby="hero-title">
  <div>
    <span class="hero-pill text-button">{{ hero_date_label }}</span>
    <h1 class="hero-title text-display" id="hero-title">Fresh from the oven</h1>
    <p class="hero-subtitle text-body">Start your day with a sprinkle of sweetness. We bake a brand-new, wholesome joke every single morning to make you smile.</p>
  </div>
  <article class="hero-card" id="daily-joke-card" aria-labelledby="hero-card-title">
    {% if daily_joke %}
    <div class="joke-viewer" data-joke-viewer>
      <div class="joke-carousel">
        <div class="joke-carousel-viewport">
          <div class="joke-carousel-track">
            <div class="joke-slide" aria-hidden="false">
              <div class="joke-slide-media">
                {% if daily_joke.setup_image_url %}
                <img src="{{ daily_joke.setup_image_url | replace('width=1024', 'width=' ~ 800) }}" alt="{{ daily_joke.setup_text }}" width="800" height="800" loading="lazy">
                {% else %}
                <div class="joke-slide-placeholder text-button">Illustration baking…</div>
                {% endif %}
              </div>
            </div>
            <div class="joke-slide" id="daily-joke-punchline" aria-hidden="true">
              <div class="joke-slide-media">
                {% if daily_joke.punchline_image_url %}
                <img src="{{ daily_joke.punchline_image_url | replace('width=1024', 'width=' ~ 800) }}" alt="{{ daily_joke.punchline_text }}" width="800" height="800" loading="lazy">
                {% else %}
                <div class="joke-slide-placeholder text-button">Punchline ready to read!</div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
      <button class="joke-reveal text-button"
        type="button"
        data-role="reveal"
        data-label-show="Reveal Punchline"
        data-label-hide="Back to Setup"
        aria-controls="daily-joke-punchline"
        aria-expanded="false"
        data-analytics-event="web_index_joke_reveal_click"
        data-analytics-label="{{ daily_joke.key or 'daily_joke' }}">
        Reveal Punchline
      </button>
    </div>
    {% else %}
    <div class="hero-card__image">
      <div class="app-highlight__placeholder text-button">Illustration baking…</div>
    </div>
    <p class="joke-punchline text-button">Check back soon for a fresh punchline!</p>
    {% endif %}
  </article>
</section>

<section class="favorites-section" aria-labelledby="favorites-title">
  <header class="section-header">
    <h2 class="favorites-title text-section-heading" id="favorites-title">Fan Favorites from the Cookie Jar</h2>
    <p class="favorites-subtitle text-body">A handful of the most-loved jokes, straight from the Snickerdoodle community.</p>
  </header>
  {% if favorites %}
  <div class="favorites-grid">
    {% for joke in favorites %}
    <article class="joke-card" aria-label="Fan favorite joke {{ loop.index }}">
      <div class="joke-viewer" data-joke-viewer>
        <div class="joke-carousel">
          <div class="joke-carousel-viewport">
            <div class="joke-carousel-track">
              <div class="joke-slide" aria-hidden="false">
                <div class="joke-slide-media">
                  {% if joke.setup_image_url %}
                  <img src="{{ joke.setup_image_url | replace('width=1024', 'width=' ~ 600) }}" alt="{{ joke.setup_text }}" width="600" height="600" loading="lazy">
                  {% else %}
                  <div class="joke-slide-placeholder text-button">Illustration baking…</div>
                  {% endif %}
                </div>
              </div>
              <div class="joke-slide" id="favorite-{{ loop.index }}-punchline" aria-hidden="true">
                <div class="joke-slide-media">
                  {% if joke.punchline_image_url %}
                  <img src="{{ joke.punchline_image_url | replace('width=1024', 'width=' ~ 600) }}" alt="{{ joke.punchline_text }}" width="600" height="600" loading="lazy">
                  {% else %}
                  <div class="joke-slide-placeholder text-button">Punchline ready to read!</div>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
        <button class="joke-reveal text-button"
          type="button"
          data-role="reveal"
          data-label-show="Reveal Punchline"
          data-label-hide="Back to Setup"
          aria-controls="favorite-{{ loop.index }}-punchline"
          aria-expanded="false"
          data-analytics-event="web_index_joke_reveal_click"
          data-analytics-label="{{ joke.key or 'favorite_joke' }}">
          Reveal Punchline
        </button>
      </div>
    </article>
    {% endfor %}
  </div>
  {% else %}
  <p class="favorites-subtitle text-body">Our cookie jar is cooling—check back soon for more fan-favorite jokes.</p>
  {% endif %}
</section>

<section class="app-highlight" id="app-highlight" aria-labelledby="app-highlight-title">
  <div class="app-highlight__media" aria-hidden="true">
    <img src="https://images.quillsstorybook.com/cdn-cgi/image/width=600,format=auto,quality=70/_joke_assets/phone_discover.png"
      alt="App preview" class="app-highlight__device-image" loading="lazy">
  </div>
  <div class="app-highlight__copy">
    <h2 id="app-highlight-title" class="text-section-heading inverse">Get your daily giggle delivered.</h2>
    <p class="text-body text-body inverse">Start your morning with our fresh-baked joke of the day. Still hungry for more? Dive into a personalized feed of funny illustrations tailored specifically to your taste.</p>
    <div class="app-highlight__stats">
      <div class="app-highlight__stat-card">
        <img src="https://images.quillsstorybook.com/cdn-cgi/image/height=64,format=auto,quality=70/_joke_assets/icon_stars.png"
             class="app-highlight__stat-icon" alt="Stars" loading="lazy">
        <div class="app-highlight__stat-copy">
          <span class="app-highlight__stat-label text-button">4.7 Stars</span>
          <span class="app-highlight__stat-caption">US Play Store</span>
        </div>
      </div>
      <div class="app-highlight__stat-card">
        <img src="https://images.quillsstorybook.com/cdn-cgi/image/height=64,format=auto,quality=70/_joke_assets/icon_downloads.png"
             class="app-highlight__stat-icon" alt="Downloads" loading="lazy">
        <div class="app-highlight__stat-copy">
          <span class="app-highlight__stat-label text-button">10k+</span>
          <span class="app-highlight__stat-caption">Downloads</span>
        </div>
      </div>
      <div class="app-highlight__stat-card">
        <img src="https://images.quillsstorybook.com/cdn-cgi/image/height=64,format=auto,quality=70/_joke_assets/icon_laughs.png"
             class="app-highlight__stat-icon" alt="Laughs" loading="lazy">
        <div class="app-highlight__stat-copy">
          <span class="app-highlight__stat-label text-button">300k+</span>
          <span class="app-highlight__stat-caption">Laughs Delivered</span>
        </div>
      </div>
    </div>
    <div class="app-highlight__store-badges">
      <a href="https://play.google.com/store/apps/details?id=com.builtwithporpoise.jokes"
        class="store-badge-link" target="_blank" rel="noopener noreferrer" aria-label="Get it on Google Play"
        data-analytics-event="web_index_play_store_click" data-analytics-label="joke_end_card">
        <img class="store-badge" alt="Get it on Google Play"
          src="https://images.quillsstorybook.com/cdn-cgi/image/height=60,format=auto,quality=80/_joke_assets/cta_play_store.png" loading="lazy">
      </a>
      <div class="store-badge-wrapper">
        <button type="button" class="store-badge-btn" aria-label="Download on the App Store"
          data-analytics-event="web_index_app_store_click" data-analytics-label="joke_end_card_coming_soon">
          <img class="store-badge" alt="Download on the App Store"
            src="https://images.quillsstorybook.com/cdn-cgi/image/height=60,format=auto,quality=80/_joke_assets/cta_app_store.png"
            loading="lazy">
        </button>
        <div class="store-tooltip" role="tooltip" aria-hidden="true">iPhone app coming soon!</div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
(function () {
  function initViewer(root) {
    const track = root.querySelector('.joke-carousel-track');
    const slides = root.querySelectorAll('.joke-slide');
    const toggle = root.querySelector('[data-role="reveal"]');
    if (!track || slides.length < 2 || !toggle) {
      return;
    }

    const showLabel = toggle.getAttribute('data-label-show') || toggle.textContent || 'Reveal';
    const hideLabel = toggle.getAttribute('data-label-hide') || showLabel;
    const setupSlide = slides[0];
    const punchlineSlide = slides[1];

    function setState(isRevealed) {
      root.classList.toggle('is-revealed', isRevealed);
      toggle.textContent = isRevealed ? hideLabel : showLabel;
      toggle.setAttribute('aria-expanded', String(isRevealed));
      setupSlide.setAttribute('aria-hidden', String(isRevealed));
      punchlineSlide.setAttribute('aria-hidden', String(!isRevealed));
    }

    setState(false);
    toggle.addEventListener('click', function () {
      setState(!root.classList.contains('is-revealed'));
    });
  }

  document.querySelectorAll('[data-joke-viewer]').forEach(initViewer);

  // Tooltip logic for App Store button
  document.querySelectorAll('.store-badge-wrapper').forEach(function (wrapper) {
    const btn = wrapper.querySelector('.store-badge-btn');
    const tooltip = wrapper.querySelector('.store-tooltip');

    if (!btn || !tooltip) return;

    function show() {
      tooltip.classList.add('tooltip--visible');
      tooltip.setAttribute('aria-hidden', 'false');
      // Analytics are handled by global handler on the button
    }

    function hide() {
      tooltip.classList.remove('tooltip--visible');
      tooltip.setAttribute('aria-hidden', 'true');
    }

    function toggle(e) {
      e.preventDefault();
      e.stopPropagation();
      if (tooltip.classList.contains('tooltip--visible')) {
        hide();
      } else {
        show();
      }
    }

    btn.addEventListener('click', toggle);

    // Close on click outside
    document.addEventListener('click', function (e) {
      if (!wrapper.contains(e.target)) {
        hide();
      }
    });

    // Close on Escape
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape') {
        hide();
      }
    });
  });
})();
</script>
{% endblock %}
