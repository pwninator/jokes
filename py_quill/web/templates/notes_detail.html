{% extends "base.html" %}
{% from "components/notes_signin.html" import notes_signin_card with context %}
{% from "components/notes_sheet_grid.html" import notes_sheet_grid with context %}

{% block title %}{{ page_title }} | {{ site_name }}{% endblock %}
{% block meta_description %}Download the {{ category_label }} Joke Pack {{ sheet_index }} printable PDF for free.{%
endblock %}

{% block content %}
<section class="section-center notes-detail" aria-labelledby="notes-detail-title">
  <h1 class="notes-detail__title text-display" id="notes-detail-title">{{ display_title }}</h1>
  <div class="notes-detail__image">
    <img src="{{ image_url }}" alt="{{ category_label }} joke notes pack {{ sheet_display_index }}"
      width="{{ notes_detail_image_width }}" height="{{ notes_detail_image_height }}" loading="lazy" />
  </div>
  <a class="nav-cta text-button notes-detail__cta button-full" href="{{ pdf_url }}" target="_blank"
    rel="noopener noreferrer" data-analytics-event="web_notes_download_click" data-analytics-label="{{ category_id }}"
    data-analytics-params="{{ {
      'category_id': category_id,
      'category_label': category_label,
      'index': sheet_index,
      'slug': sheet_slug,
      'access': 'available'
    } | tojson }}">
    Download Free PDF
  </a>
  <div class="notes-detail__ad" aria-label="Advertisement">
    <!-- printable_notes_details_post_download -->
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2479966366450616" data-ad-slot="8914785147"
      data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
</section>

<section class="section-center" aria-labelledby="notes-related-title">
  <header class="section-header">
    <h2 class="text-section-heading" id="notes-related-title">You Might Also Like</h2>
  </header>

  {% if related_cards %}
  {{ notes_sheet_grid(related_cards) }}
  {% else %}
  <p class="text-body notes-grid-empty">More printable joke packs are on the way.</p>
  {% endif %}
</section>

{% if is_signed_in %}
<section class="section-center notes-related-section--category" aria-labelledby="notes-category-title">
  <header class="section-header">
    <h2 class="text-section-heading" id="notes-category-title">Other {{ category_label }} Joke Packs</h2>
  </header>

  {% if category_cards %}
  {{ notes_sheet_grid(category_cards) }}
  {% else %}
  <p class="text-body notes-grid-empty">More {{ category_label }} joke packs are on the way.</p>
  {% endif %}
</section>
{% else %}
{{ notes_signin_card(hook_text=notes_hook_text, continue_url=email_link_url, category_label=category_label, promo_cards=category_cards, promo_width=promo_image_width, promo_quality=promo_image_quality) }}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const downloadBtn = document.querySelector('.notes-detail__cta');
    const signinSection = document.querySelector('[data-notes-signin-section]');

    if (downloadBtn && signinSection) {
      downloadBtn.addEventListener('click', function () {
        // Move the sign-in section to be right after the download button
        // but inside the same container.
        downloadBtn.parentNode.insertBefore(signinSection, downloadBtn.nextSibling);
      });
    }
  });
</script>
{% endif %}
{% endblock %}