{% extends "base.html" %}
{% from "components/notes_signin.html" import notes_signin_card with context %}
{% from "components/notes_sheet_grid.html" import notes_sheet_grid with context %}

{% block title %}{{ page_title }} | {{ site_name }}{% endblock %}
{% block meta_description %}{% if category_label %}Download the free {{ category_label }} Joke Lunchbox Notes printable PDF.{% else %}Download free Joke Lunchbox Notes printable PDF.{% endif %}{% endblock %}

{% block content %}
<section class="section-center notes-detail" aria-labelledby="notes-detail-title">
  <header class="section-header">
    <h1 class="text-display" id="notes-detail-title">{{ display_title }}</h1>
  </header>
  <div class="notes-detail__image">
    <img src="{{ image_url }}" alt="{% if category_label %}{{ category_label }} joke notes pack {{ sheet_display_index }}{% else %}Joke lunchbox notes{% endif %}"
      width="{{ notes_detail_image_width }}" height="{{ notes_detail_image_height }}" loading="lazy" />
  </div>
  <a class="nav-cta text-button notes-detail__cta button-full" href="{{ pdf_url }}" target="_blank"
    rel="noopener noreferrer"
    data-meta-event="Lead"
    data-analytics-event="web_notes_download_click"
    data-analytics-label="notes_download"
    data-analytics-params="{{ {
      'category_id': category_id or 'custom',
      'category_label': category_label or 'custom',
      'index': sheet_index or 0,
      'slug': sheet_slug or '',
      'access': 'available'
    } | tojson }}"
    {% if books_redirect_url %}data-books-redirect-url="{{ books_redirect_url }}"{% endif %}>
    Download Free PDF
  </a>
  {# Commented out for now because Adsense ads are not enabled yet. #}
  {# <div class="notes-detail__ad" aria-label="Advertisement">
    <!-- printable_notes_details_post_download -->
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2479966366450616" data-ad-slot="8914785147"
      data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div> #}
</section>

{% if not is_signed_in %}
{{ notes_signin_card(hook_text=notes_hook_text, continue_url=email_link_url, category_label=category_label,
category_count=category_sheet_count, fan_stack=fan_stack) }}
{% endif %}

<section class="section-center" aria-labelledby="notes-related-title">
  <header class="section-header">
    <h2 class="text-section-heading" id="notes-related-title">You Might Also Like</h2>
  </header>

  {% if related_cards %}
  {{ notes_sheet_grid(related_cards) }}
  {% else %}
  <p class="text-body notes-grid-empty">More printable joke packs are on the way.</p>
  {% endif %}
</section>

{% if is_signed_in and category_id %}
<section class="section-center notes-related-section--category" aria-labelledby="notes-category-title">
  <header class="section-header">
    <h2 class="text-section-heading" id="notes-category-title">Other {{ category_label }} Joke Packs</h2>
  </header>

  {% if category_cards %}
  {{ notes_sheet_grid(category_cards) }}
  {% else %}
  <p class="text-body notes-grid-empty">More {{ category_label }} joke packs are on the way.</p>
  {% endif %}
</section>
{% endif %}

{% if books_redirect_url %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const downloadBtn = document.querySelector('.notes-detail__cta');
    const booksRedirectUrl = downloadBtn ? downloadBtn.getAttribute('data-books-redirect-url') : '';

    if (!downloadBtn || !booksRedirectUrl) {
      return;
    }

    downloadBtn.addEventListener('click', function () {
      window.setTimeout(function () {
        window.location.assign(booksRedirectUrl);
      }, 100);
    });
  });
</script>
{% elif (not is_signed_in) and category_id %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const downloadBtn = document.querySelector('.notes-detail__cta');
    const signinSection = document.querySelector('[data-notes-signin-section]');

    if (downloadBtn && signinSection) {
      downloadBtn.addEventListener('click', function () {
        signinSection.scrollIntoView({ behavior: 'smooth' });
      });
    }
  });
</script>
{% endif %}
{% endblock %}
