<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}{{ site_name }}{% endblock %}</title>
  {% block head_meta %}{% endblock %}
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  {% if site_css %}
  <style>{{ site_css|safe }}</style>
  {% endif %}
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  {% block head_extra %}{% endblock %}
  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2479966366450616"
     crossorigin="anonymous"></script>
</head>

<body{% block body_attrs %}{% endblock %}>
  {% block body %}{% endblock %}
  <!-- Global analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-D2B7E8PXJJ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); } // eslint-disable-line
    gtag('js', new Date());
    gtag('config', 'G-D2B7E8PXJJ');
  </script>
  <!-- Meta Pixel Code -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1385779502901422');
    fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1385779502901422&ev=PageView&noscript=1"
  /></noscript>
  <!-- End Meta Pixel Code -->
  <script>
    (function () {
      if (typeof document === 'undefined' || !document.addEventListener) {
        return;
      }
      document.addEventListener('click', function (event) {
        var target = event.target;
        if (!target || typeof target.closest !== 'function') {
          return;
        }
        var tracker = target.closest('[data-analytics-event]');
        if (!tracker) {
          return;
        }
        var eventName = tracker.dataset.analyticsEvent;
        if (!eventName) {
          return;
        }
        var params = {};
        var rawParams = tracker.dataset.analyticsParams;
        if (rawParams) {
          try {
            var parsedParams = JSON.parse(rawParams);
            if (parsedParams && typeof parsedParams === 'object') {
              for (var key in parsedParams) {
                if (Object.prototype.hasOwnProperty.call(parsedParams, key)) {
                  params[key] = parsedParams[key];
                }
              }
            }
          } catch (e) {
            // Ignore invalid JSON.
          }
        }
        var label = tracker.dataset.analyticsLabel;
        if (label) {
          params.event_label = label;
        }
        var value = tracker.dataset.analyticsValue;
        if (value) {
          var numericValue = Number(value);
          params.value = isNaN(numericValue) ? value : numericValue;
        }
        params.transport_type = 'beacon';
        if (typeof window.gtag === 'function') {
          window.gtag('event', eventName, params);
        }
      });
    })();
  </script>
  <script>
    (function () {
      if (typeof document === 'undefined' || !document.querySelectorAll) {
        return;
      }
      var menus = Array.prototype.slice.call(
        document.querySelectorAll('[data-user-menu]')
      );
      if (!menus.length) {
        return;
      }

      var sessionInfoUrl = menus[0].dataset.sessionInfoUrl || '/session-info';
      var logoutUrl = menus[0].dataset.logoutUrl || '/logout';

      function setMenuVisible(menu, label) {
        menu.classList.add('user-menu--visible');
        var labelEl = menu.querySelector('[data-user-menu-label]');
        if (labelEl) {
          labelEl.textContent = label;
        }
      }

      function closeMenu(menu) {
        if (!menu.classList.contains('user-menu--open')) {
          return;
        }
        menu.classList.remove('user-menu--open');
        var trigger = menu.querySelector('[data-user-menu-trigger]');
        if (trigger) {
          trigger.setAttribute('aria-expanded', 'false');
        }
      }

      function openMenu(menu) {
        menu.classList.add('user-menu--open');
        var trigger = menu.querySelector('[data-user-menu-trigger]');
        if (trigger) {
          trigger.setAttribute('aria-expanded', 'true');
        }
      }

      function attachMenu(menu, label) {
        setMenuVisible(menu, label);
        var trigger = menu.querySelector('[data-user-menu-trigger]');
        var logoutButton = menu.querySelector('[data-user-menu-action="logout"]');
        if (!trigger) {
          return;
        }

        trigger.addEventListener('click', function (event) {
          event.stopPropagation();
          if (menu.classList.contains('user-menu--open')) {
            closeMenu(menu);
          } else {
            openMenu(menu);
          }
        });

        document.addEventListener('click', function (event) {
          if (!menu.contains(event.target)) {
            closeMenu(menu);
          }
        });

        document.addEventListener('keydown', function (event) {
          if (event.key === 'Escape') {
            closeMenu(menu);
          }
        });

        if (logoutButton) {
          logoutButton.addEventListener('click', function () {
            fetch(logoutUrl, {
              method: 'POST',
              headers: { 'Accept': 'application/json' },
              credentials: 'same-origin',
            })
              .catch(function () {})
              .finally(function () {
                window.location.reload();
              });
          });
        }
      }

      function handleSession(data) {
        if (!data || !data.authenticated) {
          return;
        }
        var label = data.email || data.uid || 'Account';
        menus.forEach(function (menu) {
          attachMenu(menu, label);
        });
      }

      fetch(sessionInfoUrl, {
        headers: { 'Accept': 'application/json' },
        credentials: 'same-origin',
      })
        .then(function (response) {
          if (!response.ok) {
            return null;
          }
          var contentType = response.headers.get('Content-Type') || '';
          if (contentType.indexOf('application/json') === -1) {
            return null;
          }
          return response.json();
        })
        .then(handleSession)
        .catch(function () {});
    })();
  </script>
  <script>
    (function () {
      if (typeof document === 'undefined') { return; }
      
      var trigger = document.querySelector('[data-mobile-menu-trigger]');
      var panel = document.querySelector('[data-mobile-menu-panel]');
      
      if (!trigger || !panel) { return; }
      
      trigger.addEventListener('click', function(e) {
        e.stopPropagation();
        var isHidden = panel.hasAttribute('hidden');
        if (isHidden) {
          panel.removeAttribute('hidden');
          trigger.setAttribute('aria-expanded', 'true');
        } else {
          panel.setAttribute('hidden', '');
          trigger.setAttribute('aria-expanded', 'false');
        }
      });
      
      document.addEventListener('click', function(e) {
        if (!panel.hasAttribute('hidden') && !panel.contains(e.target) && !trigger.contains(e.target)) {
          panel.setAttribute('hidden', '');
          trigger.setAttribute('aria-expanded', 'false');
        }
      });
      
       document.addEventListener('keydown', function (event) {
          if (event.key === 'Escape' && !panel.hasAttribute('hidden')) {
            panel.setAttribute('hidden', '');
            trigger.setAttribute('aria-expanded', 'false');
            trigger.focus();
          }
        });
    })();
  </script>
  {% block scripts %}
  <script>
(function () {
  'use strict';

  const header = document.querySelector('.site-header');
  if (!header) {
    return;
  }

  const FLOAT_SCROLL_THRESHOLD = 1000;
  const SCROLL_THRESHOLD = 10;
  let lastScrollY = window.scrollY || window.pageYOffset;
  let ticking = false;
  let hasEnteredFloatingZone = false;

  function dockHeader() {
    header.classList.remove('site-header--floating', 'site-header--visible');
    header.classList.add('site-header--docked');
  }

  function floatHeader() {
    header.classList.remove('site-header--docked');
    header.classList.add('site-header--floating');
  }

  function updateFloatingVisibility(currentScrollY) {
    const scrollDiff = Math.abs(currentScrollY - lastScrollY);
    if (scrollDiff < SCROLL_THRESHOLD) {
      return false;
    }

    if (currentScrollY < lastScrollY) {
      // Scrolling up: show header
      header.classList.add('site-header--visible');
    } else {
      // Scrolling down: hide header
      header.classList.remove('site-header--visible');
    }
    return true;
  }

  function updateHeader() {
    const currentScrollY = window.scrollY || window.pageYOffset;
    const shouldBeDocked = currentScrollY === 0;
    const shouldBeFloating = currentScrollY > FLOAT_SCROLL_THRESHOLD || hasEnteredFloatingZone;

    if (shouldBeDocked) {
      // At scroll position 0: Always dock and reset floating zone state
      if (!header.classList.contains('site-header--docked')) {
        dockHeader();
      }
      hasEnteredFloatingZone = false;
    } else if (shouldBeFloating) {
      // Float the header (either past threshold or after entering floating zone)
      if (currentScrollY > FLOAT_SCROLL_THRESHOLD) {
        hasEnteredFloatingZone = true;
      }
      if (!header.classList.contains('site-header--floating')) {
        floatHeader();
      }
      // Update visibility based on scroll direction
      updateFloatingVisibility(currentScrollY);
    } else {
      // Between 1-1000 and haven't entered floating zone: ensure docked
      if (!header.classList.contains('site-header--docked')) {
        dockHeader();
      }
    }

    lastScrollY = currentScrollY;
    ticking = false;
  }

  function onScroll() {
    if (!ticking) {
      window.requestAnimationFrame(updateHeader);
      ticking = true;
    }
  }

  // Initialize header state based on initial scroll position
  updateHeader();
  lastScrollY = window.scrollY || window.pageYOffset;

  // Listen for scroll events
  window.addEventListener('scroll', onScroll, { passive: true });
})();
  </script>
  <script>
(function () {
  function initViewer(root) {
    // Skip if already initialized
    if (root.dataset.jokeViewerInitialized) {
      return;
    }

    const track = root.querySelector('.joke-carousel-track');
    const slides = root.querySelectorAll('.joke-slide');
    const toggle = root.querySelector('[data-role="reveal"]');
    if (!track || slides.length < 2 || !toggle) {
      return;
    }

    const showLabel = toggle.getAttribute('data-label-show') || toggle.textContent || 'Reveal';
    const hideLabel = toggle.getAttribute('data-label-hide') || showLabel;
    const setupSlide = slides[0];
    const punchlineSlide = slides[1];

    function setState(isRevealed) {
      root.classList.toggle('is-revealed', isRevealed);
      toggle.textContent = isRevealed ? hideLabel : showLabel;
      toggle.setAttribute('aria-expanded', String(isRevealed));
      setupSlide.setAttribute('aria-hidden', String(isRevealed));
      punchlineSlide.setAttribute('aria-hidden', String(!isRevealed));
    }

    setState(false);
    toggle.addEventListener('click', function () {
      setState(!root.classList.contains('is-revealed'));
    });

    // Mark as initialized to prevent duplicate initialization
    root.dataset.jokeViewerInitialized = 'true';
  }

  // Make initViewer globally accessible for dynamically loaded content
  window.initJokeViewer = initViewer;

  // Initialize all existing viewers on page load
  document.querySelectorAll('[data-joke-viewer]').forEach(initViewer);
})();
  </script>
  {% endblock %}
</body>

</html>

